# 浏览器安全

#浏览器安全可以分为3大类
* web页面安全
*浏览器网络安全
*浏览器系统安全
#同源策略
如果两个URL的协议、域名和端口都相同，我们就称这两个URL同源。
## DOM层面
同源策略限制了来自不同源的JavaScript脚本对当前DOM对象读和写的操作。
㈱数据层面
同源策略限制了不同源的站点读取当前站点的Cookie> IndexDB、LocalStorage；等数据。
㈱网络层面
同源策略限制了通过XMLHttpRequest等方式将站点的数据发送给不同源的站点°
#安全和便利性的权衡
##页面中可以嵌入第三方资源
页面中可以引用第三方资源，不过这也暴露了很多诸如XSS的安全问题，因此又在这种开放的基础之上引入了 CSP 来限制其自由程度。
CSP的核心思想是让服务器决定浏览器能够加载哪些资源，让服务器决定浏览器是否能够执行内联JavaScript代 码。
##跨域资源共享和跨文档消息机制
跨域资源共享(CORS)
使用XMLHttpRequest和Fetch都是无法直接进行跨域请求的，因此浏览器又在这种严格策略的基础之上引入了 跨域资源共享策略，「让其可以安全地进行跨域操作。
跨文档消息机制'上：■
两个不同源的，DOM.是不能相互操纵的，因此，浏览器中又实现了跨文档消息机制，让其可以比较安全地通信。
#什么是XSS攻击
XSS攻击是指黑客往HTML文件中或者DOM中注入恶意脚本，从而在用户浏览页面时利用注入的恶意脚本对用户 实施攻击的一种手段。
## XSS可以造成哪些攻击
*窃取Cookie信息
*监听用户行为
*修改DOM
*在页面内生成浮窗广告
#恶意脚本是怎么注入的
##存储型XSS攻击
*首先黑客利用站点漏洞将一段恶意JavaScript代码提交到网站的数据库中；
*然后用户向网站请求包含了恶意JavaScript脚本的页面；
*当用户浏览该页面的时候，恶意脚本就会将用户的Cookie信息等数据上传到服务器。
㈱反射型XSS攻击
我们会发现用户将一段含有恶意代码的请求提交给Web服务器，Web服务器接收到请求时厂又将恶意代码反射给 了浏览器端，这就是反射型XSS攻击。在现实生活中，黑客经常会通过QQ群或者邮件等渠道诱导用户去点击这 些恶意链接，所以对于一些链接我们一定要慎之又慎。另外需要注意的是，Web服务器不会存储反射型XSS攻击 的恶意脚本，这是和存储型XSS攻击不同的地方。
㈱基于DOM的XSS攻击
黑客通过各种手段将恶意脚本注入用户的页面中，比如通过网络劫持在页面传输过程中修改HTML页面的内容，这 种劫持类型很多，有通过WiFi路由器劫持的，有通过本地恶意软件来劫持的，它们的共同点是在Web资源传输 过程或者在用户使用页面的过程中修改Web页面的数据。
#如何阻止XSS攻击
1 .服务器对输入脚本进行过滤或转码
2.充分利用CSP策略
3.使用HttpOnly属性 #什么是CSRF攻击
CSRF攻击就是黑客利用了用户的登录状态，并通过第三方的站点来做一些坏事。
##通常当用户打开了黑客的页面后，：黑客有三种方式去实施CSRF攻击。
1.自动发起Get .请求
2.自动发起POST请求
3.引诱用户点击链接［
和XSS'不同的是，CSRF攻击不需要将恶意代码注入用户的页面，仅仅是利用服务器的漏洞和用户的登录状态来实 施攻击
#如何防止CSRF攻击
CSRF攻击的三个必要条件：
*第一个，目标站点一定要有CSRF漏洞；
*第二个，用户要登录过目标站点，并且在浏览器上保持有该站点的登录状态；
*第三个，需要用户打开一个第三方站点，可以是黑客的站点，也可以是一些论坛。
1.充分利用好Cookie的SameSite属性
通常CSRF攻击都是从第三方站点发起的，要防止CSRF攻击，我们最好能实现从第三方站点发送请求时禁止 Cookie的发送。
SameSite选项通常有Strict、Lax和None三个值：
*Strict最为严格。如果SameSite的值是Strict，那么浏览器会完全禁止第三方Cookie0简言之，如果你从 极客时间的页面中访问InfoQ的资源，而InfoQ的某些Cookie设置了 SameSite二Strict的话，那么这些 Cookie是不会被发送到InfoQ的服务器上的。只有你从InfoQ的站点去请求InfoQ的资源时，才会带上这些 Cookieo
*Lax相对宽松一点。在跨站点的情况下，从第三方站点的链接打开和从第三方站点提交Get .方式的表单这两种 方式都会携带Cookieo但如果在第三方站点中使用Post方法，或者通过img> iframe等标签加载的URL，这些 场景都不会携带Cookieo
*而如果使用None的话，在任何情况下都会发送Cookie数据。
2.验证请求的来源站点
Referer是HTTP请求头中的一个字段，记录了该HTTP请求的来源地址。〔
虽然可以通过Referer告诉服务器HTTP请求的来源，但是有一些场景是不适合将来源URL暴露给服务器的，因 此浏览器提供给开发者一个选项，可以不用上传Referer值，具体可参考Referrer Policyo 但在服务器端验证请求头中的Referer并不是太可靠，因此标准委员会又制定了 Origin属性，在一些重要的场 合，比如通过XMLHttpRequest、Fecth发起跨站请求或者通过Post方法发送请求时，都会带上Origin属性。
3.CSRF Token #安全沙箱 #在HTTP协议栈中引入安全层
总的来说，安全层有两个主要的职责：对发起HTTP请求的数据进行加密操作和对接收到HTTP的内容进行解密操 作。
#第一版：使用对称加密
要在两台电脑上加解密同一个文件，我们至少需要知道加解密方式和密钥，因此，在HTTPS发送数据之前，浏览 器和服务器之间需要协商加密方式和密钥。
HTTPS首先要协商加解密方式，这个过程就是HTTPS建立安全连接的过程。为了让加密的密钥更加难以破解，我 们让服;务器和客户端同时决定密钥，具体过程如下：
*浏览器发送它所支持的加密套件列表和一个随机数client-random，这里的加密套件是指加密的方法，加密套件 列表就是指浏览器能支持多少种加密方法列表。
*服务器会从加密套件列表中选取一个加密套件，然后还会生成一个随机数service-random ，并将 service-random和加密套件列表返回给浏览器。
*最后浏览器和服务器分别返回确认消息。
#第二版：使用非对称加密
非对称加密算法有A、B两把密钥，如果你用A密钥来加密，那么只能使用B密钥来解密；反过来，如果你要B 密钥来加密，那么只能用A密钥来解密。
*首先浏览器还是发送加密套件列表给服务器。
*然后服务器会选择一个加密套件，不过和对称加密不同的是，使用非对称加密时服务器上需要有用于浏览器加密 的公钥和服务器解密HTTP数据的私钥，由于公钥是给浏览器加密使用的，因此服务器会将加密套件和公钥一道发 送给浏览器。
*最后就是浏览器和服务器返回确认消息。
#第三版：对称加密和非对称加密搭配使用
*首先浏览器向服务器发送对称加密套件列表、非对称加密套件列表和随机数client-random；
*服务器保存随机数client-random，选择对称加密和非对称加密的套件，然后生成随机数service-random，向 浏览器发送选择的加密套件、service-random和公钥；
*浏览器保存公钥，并生成随机数pre-master，然后利用公钥对pre-master加密，并向服务器发送加密后的数 据；
*最后服务器拿出自己的私钥，解密出pre-master数据，并返回确认消息。
到此为止，服务器和浏览器就有了共同的client-random> service-random利pre-master，然后服务器和浏览器 会使用这三组随机数生成对称密钥，因为服务器和浏览器使用同一套方法来生成密钥"所以最终生成的密钥也是相 同的。	「
#第四版：添加数字证书
对于浏览器来说，数字证书有两个作用：一个是通过数字证书向浏览器证明服务器的身份，另一个是数字证书里面 包含了服务器公钥。
相较于第三版的HTTPS协议，这里主要有两点改变：
*服务器没有直接返回公钥给浏览器，而是返回了数字证书，而公钥正是包含在数字证书中的；
*在浏览器端多了一个证书验证的操作，验证了证书之后，才继续后续流程。
#数字证书的申请和验证
##如何申请数字证书
*首先极客时间需要准备一套私钥和公钥，，私钥留着自己使用；
*然后极客时间向CA机构提交公钥、［公司、站点等信息并等待认证，这个认证过程可能是收费的；
* CA通过线上、线下等多种渠道来验证极客时间所提供信息的真实性，如公司是否存在、企业是否合法、域名是 否归属该企业等;
*如信息审核通过，.CA会向极客时间签发认证的数字证书，包含了极客时间的公钥、组织信息、CA的信息、有效 时间、证书;？列号等，这些信息都是明文的，同时包含一个CA生成的签名。
这样我们就完成了极客时间数字证书的申请过程。前面几步都很好理解，不过最后一步数字签名的过程还需要解释 下：首先「CA：使用Hash函数来计算极客时间提交的明文信息，并得岀信息摘要；然后CA再使用它的私钥对信息 摘要进行加密，加密后的密文就是CA颁给极客时间的数字签名。这就相当于房管局在房产证上盖的章，这个章是 可以去验证的，同样我们也可以通过数字签名来验证是否是该CA颁发的。
在申请和使用证书的过程中，还需要注意以下三点：
1.申请数字证书是不需要提供私钥的，要确保私钥永远只能由服务器掌握；
2.数字证书最核心的是CA使用它的私钥生成的数字签名；
3.内置CA对应的证书称为根证书，根证书是最权威的机构，它们自己为自己签名，我们把这称为自签名证书。
07_加餐